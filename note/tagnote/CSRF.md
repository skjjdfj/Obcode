---
tags:
  - 漏洞
  - csrf
  - 笔记
---

CSRF 是一种安全漏洞，攻击者会诱骗用户的 Web 浏览器在用户经过身份验证的受信任站点上执行不需要的操作。这是通过利用浏览器自动包含任何相关 cookie（凭据）这一事实来实现的，允许攻击者代表用户（通过浏览器）伪造和提交未经授权的请求。攻击者的网站可能包含旨在向目标 Web 应用程序发送查询的 HTML 表单或 JavaScript 代码。

## CSRF的类型

- 传统CSRF
- XMLHttpRequest CSRF
- 基于 Flash 的 CSRF(以后可能碰不到了)

### 传统CSRF

传统的 CSRF 攻击通常集中在通过提交表单执行的状态更改操作上。受害者被诱骗提交表单，而没有意识到 cookie、URL 参数等相关数据。受害者的 Web 浏览器向受害者已经过身份验证的 Web 应用程序表单发送 HTTP 请求。这些表格用于转账、修改账户信息或更改电子邮件地址。

### XMLHttpRequest CSRF

当在没有完整的页面请求-响应周期的情况下启动操作时，会发生异步 CSRF 利用。这是现代在线应用程序的典型特征，它们利用异步服务器通信（通过 **XMLHttpRequest** 或 **Fetch**API）和 JavaScript 来生成更动态的用户界面。这些攻击使用异步调用，而不是更传统的表单提交。尽管如此，它们还是利用了用户和在线服务之间的相同信任关系。  

例如，考虑一个在线电子邮件客户端，用户可以在其中更改他们的电子邮件首选项，而无需重新加载页面。如果此在线应用程序容易受到 CSRF 攻击，黑客可能会创建一个虚假的异步 HTTP 请求，通常是 POST 请求，并更改受害者的电子邮件首选项，将他们的所有通信转发到恶意地址。

以下是异步 CSRF 攻击可能采取的步骤的简化概述：

- 受害者打开保存在浏览器 cookie 中的会话并登录到 `mailbox.thm`。  
- 攻击者使用脚本诱使受害者打开恶意网页，该脚本可以向 `mailbox.thm` 发送查询。  
- 为了修改用户的电子邮件转发首选项，攻击者页面上的恶意脚本对 `mailbox.thm/api/updateEmail` 进行 AJAX 调用（使用 XMLHttpRequest 或 Fetch）。
- `mailbox.thm` 会话 cookie 包含在受害者浏览器中的 AJAX 请求中。
- 收到 AJAX 请求后，mailbox.thm 会对其进行评估，如果不存在 CSRF 防御，则会修改受害者的设置。

