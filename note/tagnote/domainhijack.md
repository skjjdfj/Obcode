---
tags:
  - 劫持
  - 技巧
---



来源于tryhackme的房间mKingdom，难度是简单

域劫持不是专门用来提权的，但是在特定情况下，需要使用域劫持达到提权的效果

域劫持（DNS Hijacking）是一种攻击手段，攻击者通过改变DNS解析结果，将用户从正常的服务器重定向到恶意的服务器。这种攻击可以用来窃取敏感信息、展开恶意软件攻击或进行其他恶意活动。域劫持可以分为几种类型，每种类型都有不同的攻击思路和举例。

### 1. 域名注册劫持

**攻击思路：** 攻击者注册与目标域名高度相似的域名，然后利用用户输入错误或其他手段将用户引导到恶意网站。

**举例：** 假设目标域名是 `example.com`，攻击者可以注册 `examp1e.com`（注意数字1和字母l的相似性）。用户在输入错误时，可能会被引导到攻击者的恶意网站。

### 2. 缓存污染

**攻击思路：** 攻击者利用DNS解析器的缓存机制，将恶意的IP地址缓存到DNS解析器中。当用户请求目标域名时，DNS解析器会返回缓存中的恶意IP地址。

**举例：** 攻击者可以通过DNS中毒攻击将恶意的IP地址注入到DNS解析器的缓存中。当用户请求 `example.com` 时，DNS解析器会返回缓存中的恶意IP地址，从而将用户引导到恶意网站。

### 3. 网络嗅探与ARP欺骗

**攻击思路：** 攻击者利用网络嗅探工具或ARP欺骗技术，将目标网络中的DNS请求重定向到恶意的DNS服务器。

**举例：** 攻击者可以使用工具如 `ettercap` 进行ARP欺骗，将目标网络中的DNS请求重定向到攻击者控制的恶意DNS服务器。当用户请求 `example.com` 时，恶意DNS服务器会返回恶意的IP地址。

### 4. 域名注册机构攻击

**攻击思路：** 攻击者利用域名注册机构的漏洞或弱点，修改目标域名的DNS记录，将其指向恶意的IP地址。

**举例：** 攻击者可以通过社会工程学手段或利用域名注册机构的漏洞，修改 `example.com` 的DNS记录，将其指向恶意的IP地址。

### 5. 路由器或设备漏洞

**攻击思路：** 攻击者利用路由器或其他网络设备的漏洞，修改DNS解析结果，将用户引导到恶意网站。

**举例：** 攻击者可以利用某些路由器的漏洞，修改其DNS设置，将所有DNS请求重定向到恶意的DNS服务器。当用户请求 `example.com` 时，恶意DNS服务器会返回恶意的IP地址。

### 6. 恶意软件

**攻击思路：** 攻击者利用恶意软件修改目标系统的DNS设置，将所有DNS请求重定向到恶意的DNS服务器。

**举例：** 攻击者可以通过恶意软件修改目


### mKingdom的域劫持

前置条件

>这里命令 curl mkingdom.thm:85/app/castle/application/counter.sh 的 **uid 为 0**，因此如果我们可以劫持域 mkingdom.thm，那么我们就可以获得 root 权限

- 更改目标机器的/etc/hosts，把mkingdom.thm的IP改为自己的ip
- 在自己电脑上创建一个/app/castle/application/counter.sh，并打开python的简单服务器，端口是80
- counter.sh的内容是一个反弹shell
- 使用nc监听拿到shell
